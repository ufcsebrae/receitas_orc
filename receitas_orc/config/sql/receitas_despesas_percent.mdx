WITH
    -- Membro para apelidar a medida de CSN Executada
    MEMBER [Measures].[csnExecutado] AS
        [Measures].[Valor Despesa Executado CSN]

    -- Apelido para a Receita Ajustada
    MEMBER [Measures].[ReceitaAjustado] AS
        [Measures].[Valor de Receita Iniciativa Orçado - Ajustado]

    -- Apelido para a Despesa Ajustada
    MEMBER [Measures].[DespesaAjustado] AS
        [Measures].[Valor de Despesa Planejado - Ajustado]

    -- Cálculo da porcentagem, com tratamento para evitar divisão por zero
    MEMBER [Measures].[% Executado (R/D)] AS
        IIF(
            [Measures].[DespesaAjustado] = 0 OR IsEmpty([Measures].[DespesaAjustado]),
            NULL,
            [Measures].[ReceitaAjustado] / [Measures].[DespesaAjustado]
        ),
        FORMAT_STRING = "Percent"

SELECT
    -- Colunas: As medidas que queremos exibir
    {
        [Measures].[csnExecutado],
        [Measures].[ReceitaAjustado],
        [Measures].[DespesaAjustado],
        [Measures].[% Executado (R/D)]
    } ON COLUMNS,

    -- Linhas: Combinações de PPA, Iniciativa e Mês que não estejam vazias.
    -- A verificação de "vazio" agora é feita contra as medidas que estão nas COLUNAS.
    NON EMPTY (
        [PPA].[PPA com Fotografia].[Descrição de PPA com Fotografia].MEMBERS *
        [Iniciativa].[Iniciativas].[Iniciativa].MEMBERS *
        [Tempo].[Mês].[Número Mês].MEMBERS
    ) ON ROWS

FROM
    [FINANCEIRO]

WHERE
    -- Cláusula de filtro (slicer)
    (
        [Sebrae].[Sebrae].[Descrição de Sebrae].&[26],
        {
            [Tempo].[Ano e Mês].[Número Ano e Mês].&[202501] :
            [Tempo].[Ano e Mês].[Número Ano e Mês].&[202512]
        }
    )
